[На главную](../README.md)

# Пользователи и права

## 1. GitLab (Уровень управления)

Здесь хранятся все «ключи от дверей» проекта.

*   **Сущность**: `Environment Variables` (CI/CD Variables).
*   **Секреты**:
    *   `$SSH_PRIVATE_KEY`: Приватный ключ для доступа к серверам.
    *   `$CI_REGISTRY_PASSWORD`: Временный токен для доступа к образам.
*   **Роль**: Хранит секреты в зашифрованном виде и передает их в Job только во время исполнения.

## 2. Пользователь `gitlab-runner` (Уровень исполнения)

Технический пользователь на стороне сервера раннера.

*   **Место действия**: Хост-машина GitLab Runner.
*   **Функция**: Выступает в роли «менеджера». Получает задание от GitLab, запускает изолированный Docker-контейнер для сборки или деплоя.
*   **Права**:
    *   Доступ к локальному Docker-демону.
    *   Передает SSH-ключи во временную среду исполнения, чтобы та могла «достучаться» до целевых серверов.

## 3. Пользователь `deploy_user` (Уровень сервера приложений)

Основной исполнитель на серверах `dev` и `main`.

*   **Место действия**: Целевые веб-серверы (настраивается автоматически через Ansible).
*   **Права и доступ**:
    *   **SSH**: Вход только по публичному ключу (`authorized_keys`), парольный вход запрещен.
    *   **Docker**: Состоит в группе `docker`. Это позволяет управлять контейнерами (`pull`, `up`, `down`) без прав `root`.
    *   **Файловая система**: Владеет директорией `$PROJECT_ROOT` (`/home/deploy_user/app`).
*   **Ограничения**:
    *   Не имеет прав `sudo`.
    *   В случае компрометации приложения злоумышленник останется заблокированным внутри этой учетной записи без доступа к системным конфигам.

## 4. Пользователь внутри контейнера (Уровень приложения)

Самый глубокий уровень изоляции.

*   **Функция**: Изоляция кода внутри «песочницы» Docker.
*   **Ограничения**:
    *   Не видит файлы хостовой системы (кроме явно проброшенных `volumes`).
    *   Не знает о существовании `deploy_user`.
